<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>括号匹配挑战</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            width: 100%;
            max-width: 800px;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-info {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            background: #3498db;
            padding: 15px;
            border-radius: 15px;
            color: white;
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .game-info div {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-info span {
            font-size: 2rem;
            margin-top: 5px;
        }
        
        .instructions {
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .brackets-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 25px 0;
            min-height: 120px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #3498db;
        }
        
        .bracket {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            user-select: none;
        }
        
        .bracket:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .bracket.selected {
            transform: scale(1.15);
            box-shadow: 0 0 0 4px #e74c3c, 0 6px 12px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .bracket.correct {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        #reset-btn {
            background: #e74c3c;
            color: white;
        }
        
        #hint-btn {
            background: #f39c12;
            color: white;
        }
        
        #help-btn {
            background: #9b59b6;
            color: white;
        }
        
        #lang-btn {
            background: #1abc9c;
            color: white;
        }
        
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.3rem;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .success {
            background: rgba(46, 204, 113, 0.3);
            color: #27ae60;
        }
        
        .error {
            background: rgba(231, 76, 60, 0.3);
            color: #c0392b;
        }
        
        .hint {
            background: rgba(243, 156, 18, 0.3);
            color: #d35400;
        }
        
        .bracket-type {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin: 5px;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: left;
        }
        
        .modal h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal p {
            margin: 15px 0;
            line-height: 1.6;
        }
        
        .modal ul {
            padding-left: 20px;
            margin: 15px 0;
        }
        
        .modal li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        @media (max-width: 600px) {
            .bracket {
                width: 50px;
                height: 50px;
                font-size: 2rem;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .game-info {
                font-size: 1.1rem;
            }
            
            .game-info span {
                font-size: 1.6rem;
            }
            
            button {
                padding: 10px 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 id="game-title">括号匹配挑战</h1>
        
        <div class="game-info">
            <div>
                <div id="moves-label">剩余步数</div>
                <span id="moves">10</span>
            </div>
            <div>
                <div id="level-label">关卡</div>
                <span id="level">1</span>
            </div>
            <div>
                <div id="matches-label">匹配数</div>
                <span id="matches">0/6</span>
            </div>
            <div>
                <div id="time-label">时间</div>
                <span id="timer">00:00</span>
            </div>
        </div>
        
        <div class="instructions" id="instructions">
            <p>点击两个括号交换它们的位置，使所有括号正确匹配！</p>
            <p>正确匹配：() [] {} &lt;&gt; «»</p>
        </div>
        
        <div class="legend">
            <div class="bracket-type" style="background: #ff9ff3;">()</div>
            <div class="bracket-type" style="background: #54a0ff;">[]</div>
            <div class="bracket-type" style="background: #5f27cd;">{}</div>
            <div class="bracket-type" style="background: #00d2d3;">&lt;&gt;</div>
            <div class="bracket-type" style="background: #feca57;">«»</div>
        </div>
        
        <div class="brackets-container" id="brackets-container">
            <!-- 括号将通过JavaScript生成 -->
        </div>
        
        <div class="controls">
            <button id="reset-btn">重新开始</button>
            <button id="hint-btn">提示</button>
            <button id="help-btn">帮助</button>
            <button id="lang-btn">语言</button>
        </div>
        
        <div class="message" id="message">
            点击两个括号交换它们的位置！
        </div>
    </div>

    <!-- 帮助模态框 -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="help-title">游戏帮助</h2>
            <div id="help-content">
                <p>欢迎来到括号匹配挑战！这是一个测试你逻辑思维和策略能力的游戏。</p>
                
                <h3>游戏目标</h3>
                <p>通过交换括号的位置，使所有括号形成正确的匹配序列。正确匹配的示例：()、[]、{}、&lt;&gt;、«»。</p>
                
                <h3>游戏规则</h3>
                <ul>
                    <li>点击任意两个括号交换它们的位置</li>
                    <li>每次交换消耗一步</li>
                    <li>在步数用完前完成所有匹配</li>
                    <li>正确匹配的括号会高亮显示</li>
                </ul>
                
                <h3>提示</h3>
                <p>使用栈的概念来思考匹配问题：每个开括号需要一个对应的闭括号，并且它们必须正确嵌套。</p>
                
                <h3>控制按钮</h3>
                <ul>
                    <li><strong>重新开始</strong>：重置当前关卡</li>
                    <li><strong>提示</strong>：获取交换建议</li>
                    <li><strong>帮助</strong>：打开此帮助页面</li>
                    <li><strong>语言</strong>：切换游戏语言</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 多语言支持
        const LANGUAGES = {
            'zh-CN': {
                title: '括号匹配挑战',
                movesLabel: '剩余步数',
                levelLabel: '关卡',
                matchesLabel: '匹配数',
                timeLabel: '时间',
                instructions1: '点击两个括号交换它们的位置，使所有括号正确匹配！',
                instructions2: '正确匹配：() [] {} &lt;&gt; «»',
                messageStart: '点击两个括号交换它们的位置！',
                resetBtn: '重新开始',
                hintBtn: '提示',
                helpBtn: '帮助',
                langBtn: '语言',
                helpTitle: '游戏帮助',
                helpWelcome: '欢迎来到括号匹配挑战！这是一个测试你逻辑思维和策略能力的游戏。',
                helpGoal: '游戏目标',
                helpGoalText: '通过交换括号的位置，使所有括号形成正确的匹配序列。正确匹配的示例：()、[]、{}、&lt;&gt;、«»。',
                helpRules: '游戏规则',
                helpRulesList: [
                    '点击任意两个括号交换它们的位置',
                    '每次交换消耗一步',
                    '在步数用完前完成所有匹配',
                    '正确匹配的括号会高亮显示'
                ],
                helpTips: '提示',
                helpTipsText: '使用栈的概念来思考匹配问题：每个开括号需要一个对应的闭括号，并且它们必须正确嵌套。',
                helpControls: '控制按钮',
                helpControlsList: [
                    '<strong>重新开始</strong>：重置当前关卡',
                    '<strong>提示</strong>：获取交换建议',
                    '<strong>帮助</strong>：打开此帮助页面',
                    '<strong>语言</strong>：切换游戏语言'
                ],
                messageSuccess: '恭喜！你成功匹配了所有括号！',
                messageGameOver: '步数用完了！游戏结束。',
                messageWarning: '小心！只剩 {{moves}} 步了！',
                messageHint: '尝试交换位置 {{pos1}} 和 {{pos2}} 的括号！',
                messageGeneralHint: '寻找可以形成匹配对的括号进行交换！',
                nextLevel: '进入下一关...',
                languageName: '中文'
            },
            'en': {
                title: 'Bracket Matching Challenge',
                movesLabel: 'Moves Left',
                levelLabel: 'Level',
                matchesLabel: 'Matches',
                timeLabel: 'Time',
                instructions1: 'Click two brackets to swap their positions and match all brackets correctly!',
                instructions2: 'Correct matches: () [] {} &lt;&gt; «»',
                messageStart: 'Click two brackets to swap their positions!',
                resetBtn: 'Restart',
                hintBtn: 'Hint',
                helpBtn: 'Help',
                langBtn: 'Language',
                helpTitle: 'Game Help',
                helpWelcome: 'Welcome to Bracket Matching Challenge! This game tests your logical thinking and strategic skills.',
                helpGoal: 'Game Objective',
                helpGoalText: 'Swap brackets to form correctly matched sequences. Examples of correct matches: (), [], {}, &lt;&gt;, «».',
                helpRules: 'Game Rules',
                helpRulesList: [
                    'Click any two brackets to swap their positions',
                    'Each swap consumes one move',
                    'Complete all matches before running out of moves',
                    'Correctly matched brackets will be highlighted'
                ],
                helpTips: 'Tips',
                helpTipsText: 'Think in terms of a stack: each opening bracket needs a corresponding closing bracket, and they must be properly nested.',
                helpControls: 'Control Buttons',
                helpControlsList: [
                    '<strong>Restart</strong>: Reset the current level',
                    '<strong>Hint</strong>: Get swap suggestions',
                    '<strong>Help</strong>: Open this help page',
                    '<strong>Language</strong>: Switch game language'
                ],
                messageSuccess: 'Congratulations! You successfully matched all brackets!',
                messageGameOver: 'Out of moves! Game over.',
                messageWarning: 'Careful! Only {{moves}} moves left!',
                messageHint: 'Try swapping brackets at positions {{pos1}} and {{pos2}}!',
                messageGeneralHint: 'Look for brackets that can form matching pairs to swap!',
                nextLevel: 'Next level...',
                languageName: 'English'
            },
            'es': {
                title: 'Desafío de Coincidencia de Paréntesis',
                movesLabel: 'Movimientos restantes',
                levelLabel: 'Nivel',
                matchesLabel: 'Coincidencias',
                timeLabel: 'Tiempo',
                instructions1: '¡Haz clic en dos paréntesis para intercambiar sus posiciones y hacer coincidir todos los paréntesis correctamente!',
                instructions2: 'Coincidencias correctas: () [] {} &lt;&gt; «»',
                messageStart: '¡Haz clic en dos paréntesis para intercambiar sus posiciones!',
                resetBtn: 'Reiniciar',
                hintBtn: 'Pista',
                helpBtn: 'Ayuda',
                langBtn: 'Idioma',
                helpTitle: 'Ayuda del Juego',
                helpWelcome: '¡Bienvenido al Desafío de Coincidencia de Paréntesis! Este juego prueba tu pensamiento lógico y habilidades estratégicas.',
                helpGoal: 'Objetivo del Juego',
                helpGoalText: 'Intercambia paréntesis para formar secuencias correctamente emparejadas. Ejemplos de coincidencias correctas: (), [], {}, &lt;&gt;, «».',
                helpRules: 'Reglas del Juego',
                helpRulesList: [
                    'Haz clic en dos paréntesis para intercambiar sus posiciones',
                    'Cada intercambio consume un movimiento',
                    'Completa todas las coincidencias antes de quedarte sin movimientos',
                    'Los paréntesis correctamente emparejados se resaltarán'
                ],
                helpTips: 'Consejos',
                helpTipsText: 'Piensa en términos de una pila: cada paréntesis de apertura necesita un paréntesis de cierre correspondiente, y deben estar correctamente anidados.',
                helpControls: 'Botones de Control',
                helpControlsList: [
                    '<strong>Reiniciar</strong>: Restablecer el nivel actual',
                    '<strong>Pista</strong>: Obtener sugerencias de intercambio',
                    '<strong>Ayuda</strong>: Abrir esta página de ayuda',
                    '<strong>Idioma</strong>: Cambiar el idioma del juego'
                ],
                messageSuccess: '¡Felicitaciones! ¡Coincidiste correctamente todos los paréntesis!',
                messageGameOver: '¡Sin movimientos! Fin del juego.',
                messageWarning: '¡Cuidado! ¡Solo quedan {{moves}} movimientos!',
                messageHint: '¡Intenta intercambiar los paréntesis en las posiciones {{pos1}} y {{pos2}}!',
                messageGeneralHint: '¡Busca paréntesis que puedan formar pares coincidentes para intercambiar!',
                nextLevel: 'Siguiente nivel...',
                languageName: 'Español'
            }
        };
        
        // 当前语言
        let currentLang = 'zh-CN';
        
        // 游戏配置
        const CONFIG = {
            MAX_MOVES: 10,
            BRACKETS: [
                ['(', ')'],
                ['[', ']'],
                ['{', '}'],
                ['<', '>'],
                ['«', '»']
            ],
            COLORS: [
                '#ff9ff3', // 粉色
                '#54a0ff', // 蓝色
                '#5f27cd', // 紫色
                '#00d2d3', // 青色
                '#feca57'  // 黄色
            ]
        };
        
        // 游戏状态
        let gameState = {
            level: 1,
            moves: CONFIG.MAX_MOVES,
            brackets: [],
            selectedBrackets: [],
            matches: 0,
            totalMatches: 0,
            startTime: null,
            timerInterval: null
        };
        
        // DOM元素
        const elements = {
            bracketsContainer: document.getElementById('brackets-container'),
            movesDisplay: document.getElementById('moves'),
            levelDisplay: document.getElementById('level'),
            matchesDisplay: document.getElementById('matches'),
            timerDisplay: document.getElementById('timer'),
            message: document.getElementById('message'),
            resetBtn: document.getElementById('reset-btn'),
            hintBtn: document.getElementById('hint-btn'),
            helpBtn: document.getElementById('help-btn'),
            langBtn: document.getElementById('lang-btn'),
            helpModal: document.getElementById('helpModal'),
            closeModal: document.querySelector('.close'),
            // 标签元素
            gameTitle: document.getElementById('game-title'),
            movesLabel: document.getElementById('moves-label'),
            levelLabel: document.getElementById('level-label'),
            matchesLabel: document.getElementById('matches-label'),
            timeLabel: document.getElementById('time-label'),
            instructions: document.getElementById('instructions'),
            helpTitle: document.getElementById('help-title'),
            helpContent: document.getElementById('help-content')
        };
        
        // 初始化游戏
        function initGame() {
            generateBrackets();
            renderBrackets();
            updateGameState();
            updateLanguage();
            startTimer();
            elements.message.textContent = LANGUAGES[currentLang].messageStart;
            elements.message.className = "message";
        }
        
        // 生成括号序列
        function generateBrackets() {
            const level = gameState.level;
            const bracketPairs = Math.min(level + 2, 6); // 关卡越高，括号越多
            gameState.totalMatches = bracketPairs;
            
            // 创建匹配的括号对
            let bracketSet = [];
            for (let i = 0; i < bracketPairs; i++) {
                const bracketType = i % CONFIG.BRACKETS.length;
                bracketSet.push(CONFIG.BRACKETS[bracketType][0]);
                bracketSet.push(CONFIG.BRACKETS[bracketType][1]);
            }
            
            // 打乱顺序
            for (let i = bracketSet.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [bracketSet[i], bracketSet[j]] = [bracketSet[j], bracketSet[i]];
            }
            
            gameState.brackets = bracketSet;
            gameState.matches = 0;
            gameState.moves = CONFIG.MAX_MOVES;
            gameState.selectedBrackets = [];
            gameState.startTime = new Date();
        }
        
        // 渲染括号到页面
        function renderBrackets() {
            elements.bracketsContainer.innerHTML = '';
            
            gameState.brackets.forEach((bracket, index) => {
                const bracketEl = document.createElement('div');
                bracketEl.className = 'bracket';
                bracketEl.textContent = bracket;
                bracketEl.dataset.index = index;
                
                // 设置颜色
                const bracketType = getBracketType(bracket);
                bracketEl.style.backgroundColor = CONFIG.COLORS[bracketType];
                
                // 添加点击事件
                bracketEl.addEventListener('click', () => handleBracketClick(index));
                
                elements.bracketsContainer.appendChild(bracketEl);
            });
        }
        
        // 获取括号类型索引
        function getBracketType(bracket) {
            for (let i = 0; i < CONFIG.BRACKETS.length; i++) {
                if (CONFIG.BRACKETS[i].includes(bracket)) {
                    return i;
                }
            }
            return 0;
        }
        
        // 处理括号点击
        function handleBracketClick(index) {
            // 如果游戏已经结束，不允许操作
            if (gameState.moves <= 0 && gameState.matches !== gameState.totalMatches) {
                showMessage(LANGUAGES[currentLang].messageGameOver, "error");
                return;
            }
            
            // 如果已经选择了一个括号
            if (gameState.selectedBrackets.length === 1) {
                const firstIndex = gameState.selectedBrackets[0];
                
                // 如果点击的是同一个括号，取消选择
                if (firstIndex === index) {
                    gameState.selectedBrackets = [];
                    updateBracketSelection();
                    return;
                }
                
                // 交换两个括号
                [gameState.brackets[firstIndex], gameState.brackets[index]] = 
                [gameState.brackets[index], gameState.brackets[firstIndex]];
                
                // 消耗一步
                gameState.moves--;
                gameState.selectedBrackets = [];
                
                // 重新渲染
                renderBrackets();
                updateGameState();
                
                // 检查游戏状态
                checkGameState();
            } else {
                // 选择第一个括号
                gameState.selectedBrackets = [index];
                updateBracketSelection();
            }
        }
        
        // 更新括号选择状态
        function updateBracketSelection() {
            const brackets = document.querySelectorAll('.bracket');
            brackets.forEach((bracket, index) => {
                if (gameState.selectedBrackets.includes(index)) {
                    bracket.classList.add('selected');
                } else {
                    bracket.classList.remove('selected');
                }
            });
        }
        
        // 更新游戏状态显示
        function updateGameState() {
            elements.movesDisplay.textContent = gameState.moves;
            elements.levelDisplay.textContent = gameState.level;
            elements.matchesDisplay.textContent = `${gameState.matches}/${gameState.totalMatches}`;
        }
        
        // 检查游戏状态
        function checkGameState() {
            // 检查匹配情况
            gameState.matches = countMatches();
            
            // 更新匹配显示
            updateMatchDisplay();
            
            // 检查是否完成
            if (gameState.matches === gameState.totalMatches) {
                showMessage(LANGUAGES[currentLang].messageSuccess, "success");
                clearInterval(gameState.timerInterval);
                setTimeout(() => {
                    gameState.level++;
                    initGame();
                }, 2000);
                return;
            }
            
            // 检查是否步数用完
            if (gameState.moves <= 0) {
                showMessage(LANGUAGES[currentLang].messageGameOver, "error");
                clearInterval(gameState.timerInterval);
                return;
            }
            
            // 步数警告
            if (gameState.moves <= 3) {
                const warning = LANGUAGES[currentLang].messageWarning.replace('{{moves}}', gameState.moves);
                showMessage(warning, "error");
            }
        }
        
        // 计算当前匹配数量
        function countMatches() {
            const stack = [];
            let matches = 0;
            
            for (const bracket of gameState.brackets) {
                if (isOpenBracket(bracket)) {
                    stack.push(bracket);
                } else {
                    if (stack.length > 0) {
                        const lastOpen = stack.pop();
                        if (isMatchingPair(lastOpen, bracket)) {
                            matches++;
                        } else {
                            // 不匹配，清空栈
                            stack.length = 0;
                        }
                    }
                }
            }
            
            return matches;
        }
        
        // 更新匹配显示（高亮正确匹配）
        function updateMatchDisplay() {
            const brackets = document.querySelectorAll('.bracket');
            brackets.forEach(br => br.classList.remove('correct'));
            
            const stack = [];
            for (let i = 0; i < gameState.brackets.length; i++) {
                const bracket = gameState.brackets[i];
                if (isOpenBracket(bracket)) {
                    stack.push({char: bracket, index: i});
                } else {
                    if (stack.length > 0) {
                        const lastOpen = stack.pop();
                        if (isMatchingPair(lastOpen.char, bracket)) {
                            // 高亮匹配的括号
                            brackets[lastOpen.index].classList.add('correct');
                            brackets[i].classList.add('correct');
                        } else {
                            // 不匹配，清空栈
                            stack.length = 0;
                        }
                    }
                }
            }
        }
        
        // 判断是否是开括号
        function isOpenBracket(char) {
            return ['(', '[', '{', '<', '«'].includes(char);
        }
        
        // 判断是否是匹配的括号对
        function isMatchingPair(open, close) {
            return (
                (open === '(' && close === ')') ||
                (open === '[' && close === ']') ||
                (open === '{' && close === '}') ||
                (open === '<' && close === '>') ||
                (open === '«' && close === '»')
            );
        }
        
        // 显示消息
        function showMessage(text, type) {
            elements.message.textContent = text;
            elements.message.className = `message ${type}`;
        }
        
        // 显示提示
        function showHint() {
            if (gameState.moves <= 0) return;
            
            // 查找一个可以交换的括号对
            for (let i = 0; i < gameState.brackets.length; i++) {
                for (let j = i + 1; j < gameState.brackets.length; j++) {
                    // 临时交换
                    [gameState.brackets[i], gameState.brackets[j]] = 
                    [gameState.brackets[j], gameState.brackets[i]];
                    
                    const newMatches = countMatches();
                    
                    // 恢复交换
                    [gameState.brackets[i], gameState.brackets[j]] = 
                    [gameState.brackets[j], gameState.brackets[i]];
                    
                    // 如果交换后匹配数增加，则这是一个好提示
                    if (newMatches > gameState.matches) {
                        const hint = LANGUAGES[currentLang].messageHint
                            .replace('{{pos1}}', i+1)
                            .replace('{{pos2}}', j+1);
                        showMessage(hint, "hint");
                        return;
                    }
                }
            }
            
            // 如果没有找到明显的好交换，给出一般提示
            showMessage(LANGUAGES[currentLang].messageGeneralHint, "hint");
        }
        
        // 开始计时器
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.startTime = new Date();
            
            gameState.timerInterval = setInterval(() => {
                const now = new Date();
                const elapsed = Math.floor((now - gameState.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                elements.timerDisplay.textContent = `${minutes}:${seconds}`;
            }, 1000);
        }
        
        // 更新语言
        function updateLanguage() {
            const lang = LANGUAGES[currentLang];
            
            // 更新UI文本
            elements.gameTitle.textContent = lang.title;
            elements.movesLabel.textContent = lang.movesLabel;
            elements.levelLabel.textContent = lang.levelLabel;
            elements.matchesLabel.textContent = lang.matchesLabel;
            elements.timeLabel.textContent = lang.timeLabel;
            elements.instructions.innerHTML = `${lang.instructions1}<br>${lang.instructions2}`;
            elements.resetBtn.textContent = lang.resetBtn;
            elements.hintBtn.textContent = lang.hintBtn;
            elements.helpBtn.textContent = lang.helpBtn;
            elements.langBtn.textContent = lang.langBtn;
            
            // 更新帮助内容
            elements.helpTitle.textContent = lang.helpTitle;
            elements.helpContent.innerHTML = `
                <p>${lang.helpWelcome}</p>
                
                <h3>${lang.helpGoal}</h3>
                <p>${lang.helpGoalText}</p>
                
                <h3>${lang.helpRules}</h3>
                <ul>
                    ${lang.helpRulesList.map(item => `<li>${item}</li>`).join('')}
                </ul>
                
                <h3>${lang.helpTips}</h3>
                <p>${lang.helpTipsText}</p>
                
                <h3>${lang.helpControls}</h3>
                <ul>
                    ${lang.helpControlsList.map(item => `<li>${item}</li>`).join('')}
                </ul>
            `;
        }
        
        // 切换语言
        function switchLanguage() {
            const languages = Object.keys(LANGUAGES);
            const currentIndex = languages.indexOf(currentLang);
            const nextIndex = (currentIndex + 1) % languages.length;
            currentLang = languages[nextIndex];
            updateLanguage();
            
            // 更新语言按钮文本
            elements.langBtn.textContent = LANGUAGES[currentLang].languageName;
        }
        
        // 事件监听器
        elements.resetBtn.addEventListener('click', initGame);
        elements.hintBtn.addEventListener('click', showHint);
        elements.helpBtn.addEventListener('click', () => {
            elements.helpModal.style.display = "block";
        });
        elements.closeModal.addEventListener('click', () => {
            elements.helpModal.style.display = "none";
        });
        elements.langBtn.addEventListener('click', switchLanguage);
        
        // 点击模态框外部关闭
        window.addEventListener('click', (event) => {
            if (event.target === elements.helpModal) {
                elements.helpModal.style.display = "none";
            }
        });
        
        // 初始化游戏
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
